{% extends "home/event_list_base.html" %}

{% block page_title %}Events in {{ location.name|title }} - ZenChanger{% endblock %}

{% block navigation %}
<div class="nav-links">
    <a href="{% url 'event_list' %}">‚Üê Back to Events</a>
    <a href="{% url 'event_create' %}?location={{ location.id }}">Create Event Here</a>
    <a href="{% url 'eventplan_create' %}?location={{ location.id }}">Create Event Plan</a>
    <a href="{% url 'home' %}">Home</a>
</div>
{% endblock %}

{% block page_header %}
<h2>üìç Events in {{ location.name|title }}</h2>
{% endblock %}

{% block context_info %}
<div class="info-header">
    <div class="info-detail">
        <strong>Location:</strong> {{ location.full_name }}
    </div>
    <div class="info-detail">
        <strong>Country:</strong> {{ location.in_country.name|title }}
    </div>
    {% if location.timezone %}
    <div class="info-detail">
        <strong>Timezone:</strong> {{ location.timezone }}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block event_plans_section %}
<!-- Event Plans Section for this location -->
{% if event_plans %}
<div class="plans-section">
    <h3>üìÖ Event Plans for {{ location.name|title }} ({{ event_plans.count }})</h3>
    <p style="color: #666; margin-bottom: 15px;">Recurring event templates and future planned events at this location</p>
    
    <table class="plan-table">
        <thead>
            <tr>
                <th>Plan Name</th>
                <th>Recurrence</th>
                <th>Active Period</th>
                <th>Organizers</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for plan in event_plans %}
            <tr>
                <td>
                    <a href="{% url 'eventplan_detail' plan.id %}" style="color: #0066cc; text-decoration: none;">
                        {{ plan.name }}
                    </a>
                    {% if plan.description %}
                    <div style="font-size: 0.8em; color: #666; margin-top: 2px;">
                        {{ plan.description|truncatechars:80 }}
                    </div>
                    {% endif %}
                </td>
                <td>
                    {% if plan.recurrence and plan.recurrence != 'irregular' %}
                        <span class="recurrence-badge">{{ plan.get_recurrence_display }}</span>
                        {% if plan.weekday %}
                            <span class="weekday-badge">{{ plan.get_weekday_display }}</span>
                        {% endif %}
                    {% elif plan.recurrence == 'irregular' %}
                        <span style="color: #666; font-style: italic;">Irregular</span>
                    {% else %}
                        <span style="color: #666; font-style: italic;">No pattern</span>
                    {% endif %}
                </td>
                <td>
                    {% if plan.recur_from %}
                        {{ plan.recur_from|date:"M j, Y" }}
                        {% if plan.recur_until %}
                            ‚Üí {{ plan.recur_until|date:"M j, Y" }}
                        {% else %}
                            ‚Üí ongoing
                        {% endif %}
                    {% else %}
                        <span style="color: #666; font-style: italic;">Not set</span>
                    {% endif %}
                </td>
                <td>
                    {% for org in plan.organizers.all %}
                        {{ org.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        <span style="color: #666; font-style: italic;">None</span>
                    {% endfor %}
                </td>
                <td>
                    <a href="{% url 'eventplan_detail' plan.id %}" class="btn btn-plan" style="padding: 4px 8px; font-size: 0.9em;">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}

{% block events_section_header %}
<h3>üìç Individual Events</h3>
<p style="margin-bottom: 20px;">
    {% if page_obj %}
        Total events at this location: {{ page_obj.paginator.count }}
    {% else %}
        Loading events...
    {% endif %}
</p>
{% endblock %}

{% block table_headers %}
<th>Date</th>
<th>Time</th>
<th>Country</th>
<th>Organizers</th>
<th>Source</th>
<th>Actions</th>
{% endblock %}

{% block location_country_columns %}
<td>
    <a href="{% url 'country_events' event_data.event.country.code %}" class="country-link">
        {{ event_data.event.country.name|title }}
    </a>
</td>
<td>
    {% if event_data.event.organizers.all %}
        {% for org in event_data.event.organizers.all %}
        <span class="organizer-tag">{{ org.name }}</span>
        {% endfor %}
    {% else %}
        <span style="color: #999; font-style: italic;">None</span>
    {% endif %}
</td>
<td>
    {% if event_data.event.ext_data_src == 'gc' %}
    Web
    {% elif event_data.event.ext_data_src %}
    {{ event_data.event.ext_data_src|upper }}
    {% else %}
    -
    {% endif %}
</td>
{% endblock %}

{% block empty_message %}
<td colspan="6" style="text-align: center; font-style: italic;">No events found at this location.</td>
{% endblock %}