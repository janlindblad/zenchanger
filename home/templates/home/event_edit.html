{% extends "home/event_base.html" %}

{% block title %}Edit Event {{ event.id }}{% endblock %}
{% block container_width %}800px{% endblock %}

{% block nav_links %}
<a href="{% url 'event_detail' event.id %}">← Back to Event</a>
<a href="{% url 'event_list' %}">All Events</a>
<a href="{% url 'home' %}">Home</a>
{% endblock %}

{% block heading %}
<h2>Edit Event: {{ event.id }}</h2>
<div style="color: #666; font-size: 0.9em; margin-bottom: 20px;">
    Current location: {{ event.location.full_name }} | Country: {{ event.country.name|title }}
</div>
{% endblock %}

{% block initial_organizer_ids %}
{% for org in event.organizers.all %}{{ org.id }}{% if not forloop.last %},{% endif %}{% endfor %}
{% endblock %}

{% block content %}
<div class="form-container">
    <form method="post" id="event-form">
        {% csrf_token %}
        
        <!-- Date and Time Fields -->
        <div class="form-row">
            <div class="form-group">
                <label for="date">Date <span class="required">*</span></label>
                <input type="date" id="date" name="date" required value="{{ event.date|date:'Y-m-d' }}">
                <div class="help-text">Current: {{ event.date|date:"l, F j, Y" }}</div>
            </div>
            <div class="form-group">
                <label for="time_of_day">Time <span class="required">*</span></label>
                <select id="time_of_day" name="time_of_day" required>
                    <option value="">-- Select Time --</option>
                    {% for hour in "012345678901234567890123"|make_list %}
                        {% if forloop.counter0 < 24 %}
                            <option value="{{ forloop.counter0|stringformat:'02d' }}:00" 
                                    {% if event.time_of_day == forloop.counter0|stringformat:'02d'|add:':00' %}selected{% endif %}>
                                {{ forloop.counter0|stringformat:'02d' }}:00
                            </option>
                        {% endif %}
                    {% endfor %}
                </select>
                <div class="help-text">Current: {{ event.time_of_day }}</div>
            </div>
        </div>

        <!-- Location Field -->
        <div class="form-group">
            <label for="location-search">Location <span class="required">*</span></label>
            <div class="search-container">
                <input type="text" id="location-search" 
                       value="{% if event.location %}{{ event.location.name|title }} ({{ event.location.in_country.name|title }}){% endif %}"
                       placeholder="Start typing location name..." autocomplete="off">
                <div id="location-results" class="search-results"></div>
                <input type="hidden" id="location" name="location" 
                       value="{% if event.location %}{{ event.location.id }}{% endif %}" required>
            </div>
            <div id="selected-location" class="help-text">
                {% if event.location %}
                    <strong>Current:</strong> {{ event.location.full_name }}
                {% endif %}
            </div>
        </div>

        <!-- Organizers Field -->
        <div class="form-group">
            <label for="organizer-search">Organizers</label>
            <div class="search-container">
                <input type="text" id="organizer-search" placeholder="Start typing organization name..." autocomplete="off">
                <div id="organizer-results" class="search-results"></div>
            </div>
            <div id="selected-organizers" class="selected-items">
                {% for org in event.organizers.all %}
                <div class="selected-item">
                    {{ org.name }}
                    <button type="button" class="remove-item" onclick="removeOrganizer({{ org.id }}, this.parentElement)">×</button>
                    <input type="hidden" name="organizers" value="{{ org.id }}">
                </div>
                {% endfor %}
            </div>
            <div class="help-text">
                Type to search and select organizations. 
                {% if event.organizers.all %}
                    Current: {% for org in event.organizers.all %}{{ org.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
                {% else %}
                    Currently no organizers assigned.
                {% endif %}
            </div>
        </div>

        <div style="margin-top: 30px;">
            <button type="submit" class="btn">Update Event</button>
            <a href="{% url 'event_detail' event.id %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_styles %}
.current-info {
    background: #e6f3ff;
    padding: 15px;
    border-radius: 4px;
    border: 1px solid #b3d9ff;
    margin-bottom: 20px;
    font-size: 0.9em;
}
.current-info strong {
    color: #0066cc;
}
{% endblock %}