<!DOCTYPE html>
<html>
<head>
    <title>Schedules</title>
    {% include "core/base_header.html" %}
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        .folded { background: #f9f9f9; }
        .records-table { margin: 8px 0 8px 24px; }
    </style>
</head>
<body>
    <h2>Collection Schedule</h2>
    <table>
        <tr>
            <th>Source ID</th>
            <th>Source URL</th>
            <th>Plugin</th>
            <th>Cron Expression</th>
            <th>Enabled</th>
            <th>Last Run</th>
            <th>Recent Records</th>
        </tr>
        {% for item in schedule_data %}
        <tr>
            <td>{{ item.source.id }}</td>
            <td>{{ item.source.url }}</td>
            <td>{{ item.source.plugin }}</td>
            <td>{{ item.schedule.cron_expression }}</td>
            <td>{{ item.schedule.enabled }}</td>
            <td>{{ item.schedule.last_run|default:"-" }}</td>
            <td class="folded">
                {% if item.records %}
                <table class="records-table">
                    <tr>
                        <th>Timestamp</th>
                        <th>Result</th>
                    </tr>
                    {% for record in item.records %}
                    <tr>
                        <td>{{ record.timestamp }}</td>
                        <td><pre style="white-space: pre-wrap;">{{ record.result|safe }}</pre></td>
                    </tr>
                    {% endfor %}
                </table>
                {% else %}
                    No records.
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>